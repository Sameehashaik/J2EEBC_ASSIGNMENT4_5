<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container">
        <a class="navbar-brand" href="/">Evidence System</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item"><a class="nav-link" href="/evidence/all">Evidence List</a></li>
            </ul>
            <form th:action="@{/auth/logout}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-link" style="padding: 0; border: none; background: none;">Logout</button>
            </form>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-3">User Management</h2>

    <!-- Filter Summary Banner -->
    <div th:if="${username != null or role != null}"
         class="alert alert-info d-flex justify-content-between align-items-center">
        <span>
            <strong>Filtered by:</strong>
            <span th:if="${username != null}">Username: <b th:text="${username}"></b></span>
            <span th:if="${role != null}"> | Role: <b th:text="${role}"></b></span>
        </span>
        <a th:href="@{/users}" class="btn btn-sm btn-outline-secondary">Reset Filter</a>
    </div>

    <!-- Filter Form -->
    <form class="row g-3 mb-4" method="get" th:action="@{/users}">
        <div class="col-md-4">
            <input type="text" name="username" class="form-control" th:value="${username}" placeholder="Filter by Username">
        </div>
        <div class="col-md-4">
            <input type="text" name="role" class="form-control" th:value="${role}" placeholder="Filter by Role">
        </div>
        <div class="col-md-4 d-flex gap-2">
            <button type="submit" class="btn btn-primary w-50">Filter</button>
            <a th:href="@{/users}" class="btn btn-outline-secondary w-50">Reset</a>
        </div>
    </form>

    <!-- Create Button -->
    <div class="mb-3 text-end">
        <a class="btn btn-success" th:href="@{/users/create}">+ Create User</a>
    </div>

    <!-- User Table -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark text-center">
                <tr>
                    <th>ID</th>
                    <th>Username</th>
                    <th>Full Name</th>
                    <th>Roles</th>
                    <th>Enabled</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:if="${#lists.isEmpty(users)}">
                    <td colspan="6" class="text-center text-muted">No users found.</td>
                </tr>
                <tr th:each="user : ${users}">
                    <td th:text="${user.id}" class="text-center"></td>
                    <td th:text="${user.username}"></td>
                    <td th:text="${user.fullName}"></td>
                    <td>
                        <span class="badge bg-primary me-1" th:each="role : ${user.roles}" th:text="${role}">ROLE</span>
                    </td>
                    <td class="text-center">
                        <span class="badge" th:classappend="${user.enabled} ? 'bg-success' : 'bg-secondary'" th:text="${user.enabled} ? 'Yes' : 'No'">Yes</span>
                    </td>
                    <td class="text-center">
                        <a class="btn btn-sm btn-outline-primary me-1" th:href="@{/users/{id}/edit(id=${user.id})}">Edit</a>
                        <form th:action="@{/users/{id}/delete(id=${user.id})}" method="post" style="display:inline;">
                            <button class="btn btn-sm btn-outline-danger" type="submit"
                                    onclick="return confirm('Are you sure you want to delete this user?');">
                                Delete
                            </button>
                        </form>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

</body>
</html>
